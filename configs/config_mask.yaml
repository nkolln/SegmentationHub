project_name: "paintable-surface-segmentation"
experiment_name: "mask2formerl12_1024_kfoldv2"

model:
  name: "mask2former" # Options: unet_viable, segformer_hf, mask2former, dinov2
  num_classes: 12
  pretrained: true
  encoder_name: "swin-large"  # Backbone variant
  pretrained_repo: "facebook/mask2former-swin-large-cityscapes-semantic"
  num_queries: 100            # Number of object queries (default 100)

training:
  batch_size: 2 # Mask2Former is memory intensive
  gradient_accumulation_steps: 4 # Effective Batch Size = 8
  num_epochs: 80 
  learning_rate: 0.0001
  max_lr: 0.0005
  weight_decay: 0.05
  optimizer: "adamw"
  scheduler: "onecycle"
  warmup_ratio: 0.1
  seed: 42
  use_amp: true # Transformer-based models benefit greatly from AMP
  early_stopping_patience: 15
  max_grad_norm: 1.0           # Gradient clipping threshold
  # Encoder freezing options
  freeze_encoder: true           
  unfreeze_epoch: 10
  encoder_lr_mult: 0.1
  use_tta: false # Keep TTA enabled for best metrics

loss:
  class_weight: 2.0           # Maps to classification loss (replaces cross_entropy)
  mask_weight: 20.0           # Specific to Mask2Former binary mask loss
  dice_weight: 1.0            # Specific to Mask2Former dice loss
  focal:
    weight: 0.0      # Disabled to match old run
    alpha: 0.25
    gamma: 2.0
  boundary: 0.0      # Disabled to match old run
  label_smoothing: 0.1
  ignore_index: 255

data:
  root_dir: "data"
  sources: ["base", "extended"]
  image_size: 512
  train_split: 0.8
  val_split: 0.1
  test_split: 0.1
  k_folds: 5
  num_workers: 0
  # class_mapping:
  #   0: 0  # Background
  #   1: 1  # Facade
  #   2: 2  # Window
  #   3: 3  # Map unwanted class '3' to Background
  #   4: 3  # Map unwanted class '4' to Background
  #   5: 3  # Map unwanted class '5' to Background
  #   6: 3  # Map unwanted class '6' to Background
  #   7: 3  # Map unwanted class '7' to Background
  #   8: 3  # Map unwanted class '8' to Background
  #   9: 3  # Map unwanted class '9' to Background
  #   10: 3  # Map unwanted class '10' to Background
  #   11: 3  # Map unwanted class '11' to Background

logging:
  use_wandb: true
  log_every_n_steps: 10
  save_checkpoint_every_n_epochs: 5
  output_dir: "outputs/mask2former"

monitoring:
  track_gradients: true
  gradient_log_frequency: 10
  visualize_predictions_every_n_epochs: 5
